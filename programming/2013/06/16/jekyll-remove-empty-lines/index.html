<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>jekyllで生成されるHTMLから空行を取り除くプラグイン - Creataa</title>
    <meta name="author" content="kerotaa">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Web x Design x Programming x Life">
    <link href="/assets/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="single">
    <header id="site-header">
      <div class="container">
        <div class="site-hgroup">
          <h1 class="site-title"><a href="/">Creataa</a></h1>
          <p class="site-description">Web x Design x Programming x Life</p>
        </div>
        <form class="site-search" method="get" action="https://www.google.co.jp/search">
          <input class="text" type="text" name="q" placeholder="Keywords"><input class="submit" type="submit" value="search">
          <input type="hidden" name="q" value="site:http://kerotaa.github.io">
        </form>
        <nav class="site-nav">
          <ul>
      	<li><a href="/archive.html/">Archive</a></li>
      	<li><a href="/categories.html/">Categories</a></li>
      	<li><a href="/pages.html/">Pages</a></li>
      	<li><a href="/tags.html/">Tags</a></li>
          </ul>
        </nav>
        <div class="site-toggle-menu">
          <a href="#" title="Menu">menu</a>
        </div>
        <div class="site-return">
          <a href="#content" title="Return to pagetop">arrowup</a>
        </div>
      </div>
    </header>
    <div id="content">
      <div id="main">
<article class="post post-single">
  <header class="post-header">
    <h1 class="post-title">jekyllで生成されるHTMLから空行を取り除くプラグイン</h1>
    <ul class="post-meta">
      <li class="post-date">
        <time datetime="2013-06-16T00:00:00+09:00">16 June, 2013</time>
      </li>
      <li class="post-category">
        <ul>
          <li><a href="http://kerotaa.github.io/category/programming/" title="programming">programming</a></li>
        </ul>
      </li>
      <li class="post-tag">
        <ul>
          <li><a href="http://kerotaa.github.io/tag/jekyll/" title="jekyll">jekyll</a></li>
          <li><a href="http://kerotaa.github.io/tag/Ruby/" title="Ruby">Ruby</a></li>
        </ul>
      </li>
    </ul>
  </header>
  <div class="post-body">
<p>jekyllが吐き出すHTMLの先頭に空行が入ってたり変なところに空行が連続してるのが気になったのでプラグインを書いてみました。</p>
<!--more-->
<h3>ソースコード</h3>
<p><a href="https://gist.github.com/kerotaa/5788650#file-remove-empty-lines-html-rb">remove-empty-lines-html.rb</a></p>
<div class="highlight"><pre><code class="ruby"><span class="k">module</span> <span class="nn">Jekyll</span>
  <span class="k">module</span> <span class="nn">Convertible</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">destination</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
      <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
      <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">extname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span> <span class="o">==</span> <span class="s1">&#39;.html&#39;</span> <span class="k">then</span>
        <span class="nb">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">strip!</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="sr">/&lt;\/?pre[^&gt;]*&gt;/i</span>
        <span class="n">pres</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">tary</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">oary</span> <span class="o">=</span> <span class="o">[]</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="sr">/^[\s\t]*(\r\n|\r|\n)/</span>
        <span class="n">tary</span><span class="o">.</span><span class="n">each_with_index</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
          <span class="n">oary</span> <span class="o">&lt;&lt;</span> <span class="p">(</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">e</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">)</span>
          <span class="n">oary</span> <span class="o">&lt;&lt;</span> <span class="n">pres</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="k">if</span> <span class="n">pres</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">i</span>
        <span class="p">}</span>
        <span class="nb">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">oary</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
      <span class="k">end</span>
      <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="nb">self</span><span class="o">.</span><span class="n">output</span> <span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>説明</h3>
<p>生成されるファイルへの書き込み部分をオーバーライド。<br>
<code>&lt;pre&gt;</code>の中では空行を使いたい場合が多々あるので正規表現で分割して偶数要素だけに処理を施して結合してます。  <code>&lt;xmp&gt;</code>は無視しちゃってるけど使う人いないよね・・・？</p>
  </div>
  <footer class="post-footer">
  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'creataa'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    <nav class="pagination">
      <ul>
        <li class="prev"><a href="/diary/2013/06/10/hello-world/" title="Hello, World">&larr;&nbsp;Previous</a></li>
        <li class="next disabled"><a>Next&nbsp;&rarr;</a></li>
      </ul>
    </nav>
  </footer>
</article>
      </div>
      <div id="side">
        <div class="container">
  <div class="side-module side-module-recent-entries">
    <h3 class="side-module-title">Recently Entries</h3>
    <div class="side-module-body">
      <ol>
        <li><a href="http://kerotaa.github.io/programming/2013/06/16/jekyll-remove-empty-lines/" title="jekyllで生成されるHTMLから空行を取り除くプラグイン">jekyllで生成されるHTMLから空行を取り除くプラグイン</a></li>
        <li><a href="http://kerotaa.github.io/diary/2013/06/10/hello-world/" title="Hello, World">Hello, World</a></li>
      </ol>
    </div>
  </div>
  <div class="side-module side-module-tags">
    <h3 class="side-module-title">Tags</h3>
    <div class="side-module-body">
      <ul>
    	<li><a href="/tag/jekyll/">jekyll</a></li>
    	<li><a href="/tag/Ruby/">Ruby</a></li>
      </ul>
    </div>
  </div>
  <div class="side-module side-module-categories">
    <h3 class="side-module-title">Categories</h3>
    <div class="side-module-body">
      <ul>
    	<li><a href="/category/diary/">
    		Diary
    	</a><span class="count">(1)</span></li>
    	<li><a href="/category/programming/">
    		Programming
    	</a><span class="count">(1)</span></li>
      </ul>
    </div>
  </div>
  <div class="side-module side-module-archives">
    <h3 class="side-module-title">Archives</h3>
    <div class="side-module-body">
<ul>
    <li><a href="/archives/2013/06/">2013-06</a><span class="count">(2)</span></li>
</ul>
    </div>
  </div>
</div>
      </div>
    </div>
    <footer id="site-footer">
      <div class="container">
  <div class="foot-modules">
    <div class="foot-module foot-module-profile">
      <h3 class="foot-module-title">About</h3>
      <div class="foot-module-body">
        <div class="author">
          <p class="icon"><img src="/images/author.png" width="64" height="64" alt="kerotaa"></p>
          <p class="intro">
            <span class="name">kerotaa</span>
            素人趣味でWebデザインやプログラミングを楽しんでいます。
          </p>
        </div>
      </div>
    </div>
    <div class="foot-module foot-module-connect">
      <h3 class="foot-module-title">Connect</h3>
      <div class="foot-module-body">
        <ul class="sns">
          <li class="twitter"><a href="https://twitter.com/kerotaa" title="Twitter">Twitter</a></li>
          <li class="github"><a href="https://github.com/kerotaa/" title="Github">Github</a></li>
          <li class="youtube"><a href="http://www.youtube.com/channel/UC84Gyeg37bKIGxHjY3aXGOw" title="Youtube">Youtube</a></li>
          <li class="pinterest"><a href="http://pinterest.com/kerotaa/" title="Pinterest">Pinterest</a></li>
        </ul>
        <ul class="sns">
          <li class="feed"><a href="/atom.xml" title="Feed">Feed</a></li>
        </ul>
      </div>
    </div>
    <div class="foot-module foot-module-copyright">
      <h3 class="foot-module-title">Timeline</h3>
      <div class="foot-module-body">
        <a class="twitter-timeline" href="https://twitter.com/kerotaa" data-widget-id="345227121217646593" data-chrome="noscrollbar noheader nofooter noborders transparent" data-link-color="#FF6B6B">@kerotaa からのツイート</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>
    </div>
  </div>
  <div class="copyright">&copy; 2013 kerotaa. Generated by jekyll.</div>
</div>
    </footer>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.throttle.js"></script>
    <script type="text/javascript" src="/assets/js/blog.js"></script>
  </body>
</html>